workflows:
  android:
    name: Android Compose Build
    max_build_duration: 60
    instance_type: linux       # <-- must be exactly 'linux'
    environment:
      vars:
        KEYSTORE_BASE64: $CM_KEYSTORE_BASE64
        KEYSTORE_PASSWORD: $CM_KEYSTORE_PASSWORD
        KEY_ALIAS: $CM_KEY_ALIAS
        KEY_PASSWORD: $CM_KEY_PASSWORD
    cache:
      cache_paths:
        - ~/.gradle
        - ~/.gradle/caches
        - ~/.gradle/wrapper
    scripts:
      - name: Decode keystore
        script: |
          if [ -n "$KEYSTORE_BASE64" ]; then
            echo "$KEYSTORE_BASE64" | base64 --decode > keystore.jks
          fi
      - name: Build APK / AAB
        script: ./gradlew clean assembleRelease
    artifacts:
      - app/build/outputs/**/*.apk
      - app/build/outputs/**/*.aab